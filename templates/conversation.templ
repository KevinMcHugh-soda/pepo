package templates

import "time"

type Conversation struct {
        ID          string    `json:"id"`
        PersonID    string    `json:"person_id"`
        OccurredAt  time.Time `json:"occurred_at"`
        Description string    `json:"description"`
        CreatedAt   time.Time `json:"created_at"`
        UpdatedAt   time.Time `json:"updated_at"`
}

templ ConversationItem(conv Conversation) {
        <div class="border-b pb-3 mb-3" id={ "conversation-" + conv.ID }>
                <div class="flex justify-between items-start">
                        <div class="flex-1">
                                <p class="text-gray-800 mb-1">{ conv.Description }</p>
                                <div class="text-xs text-gray-500">{ conv.OccurredAt.Format("Jan 02, 2006 15:04") }</div>
                        </div>
                </div>
        </div>
}

templ ConversationList(conversations []Conversation) {
        if len(conversations) == 0 {
                <div class="text-gray-500 text-center py-4">No conversations found. Add some above!</div>
        } else {
                for _, c := range conversations {
                        @ConversationItem(c)
                }
        }
}

templ RecordConversationForm(personID string, targetSelector string) {
        <div class="bg-white rounded-lg shadow p-6 mb-6">
                <h2 class="text-xl font-semibold mb-4">Record New Conversation</h2>
                <form hx-post="/api/v1/conversations" hx-target={ targetSelector } hx-swap="afterbegin" hx-on::after-request="if(event.detail.successful) this.reset()" class="space-y-4">
                        if personID != "" {
                                <input type="hidden" name="person_id" value={ personID }/>
                        } else {
                                <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Person</label>
                                        <select
                                                name="person_id"
                                                id="conversation-person-select"
                                                required
                                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                hx-get="/api/v1/people?format=select"
                                                hx-trigger="load"
                                                hx-target="#conversation-person-select"
                                                hx-swap="innerHTML"
                                        >
                                                <option value="">Loading people...</option>
                                        </select>
                                </div>
                        }
                        <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                                <textarea
                                        name="description"
                                        required
                                        rows="2"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                ></textarea>
                        </div>
                        <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">When (optional)</label>
                                <input
                                        type="datetime-local"
                                        name="occurred_at"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                />
                        </div>
                        <div class="flex justify-end">
                                <button
                                        type="submit"
                                        class="px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500"
                                >
                                        Save Conversation
                                </button>
                        </div>
                </form>
        </div>
}

templ RecordConversationPage(personID string) {
       @Layout("Record Conversation") {
               if personID != "" {
                       <a href={ "/people/" + personID } class="text-blue-600 hover:text-blue-800 flex items-center mb-4">
                               \u2190 Back to Person
                       </a>
               } else {
                       <a href="/" class="text-blue-600 hover:text-blue-800 flex items-center mb-4">
                               \u2190 Back to People List
                       </a>
               }
               @RecordConversationForm(personID, "#conversation-form-result")
               <div id="conversation-form-result" class="mt-4"></div>
       }
}

